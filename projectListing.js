const projectListing = [
    {
        title: "Up-To-Date Plans for Everyone",
        slug: "up-to-date-plans-for-everyone",
        technologies: ["react", "node.js", "python"],
        description: `Outdated plans cause construction errors. With Benetics, that's history. Upload a new plan from your computer, and every team member has it on their phone. Even use plans offline with high-res zoom. Anytime, anywhere.`,
        links: [{
                text: "INFORMATION",
                href: "#"
            },
            {
                text: "INFORMATION",
                href: "#"
            },
            {
                text: "INFORMATION",
                href: "#"
            },
        ],
        images: [
            "https://img.freepik.com/free-photo/medium-shot-man-wearing-vr-glasses_23-2149126949.jpg?ga=GA1.1.1398945864.1722232681&semt=ais_hybrid",
            "https://img.freepik.com/free-vector/digital-global-connection-network-technology-background_1017-23324.jpg?ga=GA1.1.1398945864.1722232681&semt=ais_hybrid",
            "https://img.freepik.com/free-photo/ai-chip-intelligence-technology-deep-learning_53876-143122.jpg?ga=GA1.1.1398945864.1722232681&semt=ais_hybrid",
            "https://img.freepik.com/free-photo/asian-young-male-wearing-wearable-goggle-headset-virtual-online-meeting-digital-space-working-with-3d-augmented-dimension-homecyber-virtual-working-with-virtual-vr-goggle-pc-desktop-device_609648-2614.jpg?ga=GA1.1.1398945864.1722232681&semt=ais_hybrid",
        ],
    },
    {
        title: "Acknowledgements",
        slug: "acknowledgements",
        technologies: ["node.js"],
        description: `Outdated plans cause construction errors. With Benetics, that's history. Upload a new plan from your computer, and every team member has it on their phone. Even use plans offline with high-res zoom. Anytime, anywhere.`,
        links: [{
                text: "INFORMATION",
                href: "#"
            },
            {
                text: "INFORMATION",
                href: "#"
            },
            {
                text: "INFORMATION",
                href: "#"
            },
        ],
        images: [
            "https://img.freepik.com/free-photo/medium-shot-man-wearing-vr-glasses_23-2149126949.jpg?ga=GA1.1.1398945864.1722232681&semt=ais_hybrid",
            "https://img.freepik.com/free-vector/digital-global-connection-network-technology-background_1017-23324.jpg?ga=GA1.1.1398945864.1722232681&semt=ais_hybrid",
            "https://img.freepik.com/free-photo/ai-chip-intelligence-technology-deep-learning_53876-143122.jpg?ga=GA1.1.1398945864.1722232681&semt=ais_hybrid",
            "https://img.freepik.com/free-photo/asian-young-male-wearing-wearable-goggle-headset-virtual-online-meeting-digital-space-working-with-3d-augmented-dimension-homecyber-virtual-working-with-virtual-vr-goggle-pc-desktop-device_609648-2614.jpg?ga=GA1.1.1398945864.1722232681&semt=ais_hybrid",
        ],
    },
    {
        title: "Results",
        slug: "results",
        technologies: ["typescript", "python"],
        description: `Outdated plans cause construction errors. With Benetics, that's history. Upload a new plan from your computer, and every team member has it on their phone. Even use plans offline with high-res zoom. Anytime, anywhere.`,
        links: [{
                text: "INFORMATION",
                href: "#"
            },
            {
                text: "INFORMATION",
                href: "#"
            },
            {
                text: "INFORMATION",
                href: "#"
            },
        ],
        images: [
            "https://img.freepik.com/free-photo/medium-shot-man-wearing-vr-glasses_23-2149126949.jpg?ga=GA1.1.1398945864.1722232681&semt=ais_hybrid",
            "https://img.freepik.com/free-vector/digital-global-connection-network-technology-background_1017-23324.jpg?ga=GA1.1.1398945864.1722232681&semt=ais_hybrid",
            "https://img.freepik.com/free-photo/ai-chip-intelligence-technology-deep-learning_53876-143122.jpg?ga=GA1.1.1398945864.1722232681&semt=ais_hybrid",
            "https://img.freepik.com/free-photo/asian-young-male-wearing-wearable-goggle-headset-virtual-online-meeting-digital-space-working-with-3d-augmented-dimension-homecyber-virtual-working-with-virtual-vr-goggle-pc-desktop-device_609648-2614.jpg?ga=GA1.1.1398945864.1722232681&semt=ais_hybrid",
        ],
    },
    {
        slug: "discussion",
        title: "Discussion",
        technologies: ["rust"],
        description: `Outdated plans cause construction errors. With Benetics, that's history. Upload a new plan from your computer, and every team member has it on their phone. Even use plans offline with high-res zoom. Anytime, anywhere.`,
        links: [{
                text: "INFORMATION",
                href: "#"
            },
            {
                text: "INFORMATION",
                href: "#"
            },
            {
                text: "INFORMATION",
                href: "#"
            },
        ],
        images: [
            "https://img.freepik.com/free-photo/medium-shot-man-wearing-vr-glasses_23-2149126949.jpg?ga=GA1.1.1398945864.1722232681&semt=ais_hybrid",
            "https://img.freepik.com/free-vector/digital-global-connection-network-technology-background_1017-23324.jpg?ga=GA1.1.1398945864.1722232681&semt=ais_hybrid",
            "https://img.freepik.com/free-photo/ai-chip-intelligence-technology-deep-learning_53876-143122.jpg?ga=GA1.1.1398945864.1722232681&semt=ais_hybrid",
            "https://img.freepik.com/free-photo/asian-young-male-wearing-wearable-goggle-headset-virtual-online-meeting-digital-space-working-with-3d-augmented-dimension-homecyber-virtual-working-with-virtual-vr-goggle-pc-desktop-device_609648-2614.jpg?ga=GA1.1.1398945864.1722232681&semt=ais_hybrid",
        ],
    },
    {
        slug: "literature-cited",
        technologies: ["docker", "kubernetes", "go", "react", "node.js"],
        title: "Literature Cited",
        description: `Outdated plans cause construction errors. With Benetics, that's history. Upload a new plan from your computer, and every team member has it on their phone. Even use plans offline with high-res zoom. Anytime, anywhere.`,
        links: [{
                text: "INFORMATION",
                href: "#"
            },
            {
                text: "INFORMATION",
                href: "#"
            },
            {
                text: "INFORMATION",
                href: "#"
            },
        ],
        images: [
            "https://img.freepik.com/free-photo/medium-shot-man-wearing-vr-glasses_23-2149126949.jpg?ga=GA1.1.1398945864.1722232681&semt=ais_hybrid",
            "https://img.freepik.com/free-vector/digital-global-connection-network-technology-background_1017-23324.jpg?ga=GA1.1.1398945864.1722232681&semt=ais_hybrid",
            "https://img.freepik.com/free-photo/ai-chip-intelligence-technology-deep-learning_53876-143122.jpg?ga=GA1.1.1398945864.1722232681&semt=ais_hybrid",
            "https://img.freepik.com/free-photo/asian-young-male-wearing-wearable-goggle-headset-virtual-online-meeting-digital-space-working-with-3d-augmented-dimension-homecyber-virtual-working-with-virtual-vr-goggle-pc-desktop-device_609648-2614.jpg?ga=GA1.1.1398945864.1722232681&semt=ais_hybrid",
        ],
    },
];


const technologies = [
    {
        'slug' : 'react',
        'name': 'React',
        'color': 'bg-blue-100 text-blue-800'
    },
    {
        'slug' : 'node.js',
        'name': 'Node.js',
        'color': 'bg-green-100 text-green-800'
    },
    {
        'slug': 'python',
        'name': 'Python',
        'color': 'bg-purple-100 text-purple-800'
    },
    {
        'slug': 'typescript',
        'name': 'TypeScript',
        'color': 'bg-indigo-100 text-indigo-800'
    },
    {
        'slug': 'rust',
        'name': 'Rust',
        'color': 'bg-orange-100 text-orange-800'
    },
    {
        'slug': 'go',
        'name': 'Go',
        'color': 'bg-teal-100 text-teal-800'
    },
    {
        'slug': 'docker',
        'name': 'Docker',
        'color': 'bg-blue-200 text-blue-900'
    },
    {
        'slug': 'kubernetes',
        'name': 'Kubernetes',
        'color': 'bg-purple-100 text-purple-800'
    },
];

let activeIndex  = 0;
const contentDiv = document.querySelector(".content"); // Target the container
const appendCard = (item, index) => {

    let tech = technologies.filter(t => item.technologies.includes(t.slug));
    //console.log(tech);

    return cardHTML = `
        <h4 id="${item.slug}">${item.title}</h4>
        <div class="feature-card w-full bg-white section">
            <div class="flex items-center gap-8">
                <!-- Left Section -->
                <div class="w-1/2 maindiv">
                    
                    <ul class="list-disc p-4 lg:p-0 lg:flex-row lg:list-none xl:flex xl:gap-3">
                        ${tech?.map((t) => `
                            <li>
                                <span class="${t.color} text-xs font-medium px-2 py-2 rounded-full dark:bg-gray-700 dark:text-blue-400">${t.name}</span>
                            </li>
                        `).join("")}
                    </ul>

                    <div class="newclass">
                        <h2 class="mb-4 subtitle">${item.title}</h2>
                        <p class="mb-4 subtitle">${item.technologies?.map(ele => ele)}</p>
                        <p class="subparanew">${item.description}</p>
                    </div>
                </div>
                <!-- Right Section (Image Slider) -->
                <div class="w-1/2">
                    <div class="relative h-[450px] overflow-hidden imgsecslider">
                        <div class="swiper mySwiper">
                            <div class="swiper-wrapper">
                                ${item.images.map((image, index) => `<div class="swiper-slide"><img src="${image}" alt="Slide ${index + 1}" class="w-full h-[450px] object-contain" /></div>`).join("")}
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    `;
}

projectListing.forEach((item) => {
    const cardHTML = appendCard(item)
    contentDiv.innerHTML += cardHTML;
});

document.addEventListener('DOMContentLoaded', () => {
    const CURRENT_HEADING_CLASS = 'current';
    const scrollSpy = document.getElementById('scrollspy');
    let headings = document.querySelectorAll('section h4');
    let currentHeading = null;

    if (scrollSpy && headings.length > 0) 
    {
        // Generate initial navigation and apply `current` to the first title
        generateNavigation();
        applyCurrentClassToFirstHeading();
        document.addEventListener('scroll', calculateCurrentHeader);
    }

    // window.findDropdownValue = function(selectedTechnologies) {
    //     console.log('Selected technologies:', selectedTechnologies);

    //     const selectedArray = Array.isArray(selectedTechnologies) ?
    //         selectedTechnologies :
    //         Object.values(selectedTechnologies);

    //     // Clear previous content
    //     contentDiv.innerHTML = '';

    //     const TechbaseProject = projectListing?.filter((project) => {
    //         const projectTechnologies = project.technologies.map((tech) => tech.toLowerCase());

    //         // Check if all selected technologies exist in the project's technologies
    //         return selectedArray.every((selectedTech) =>
    //             projectTechnologies.includes(selectedTech.toLowerCase())
    //         );
    //     });

    //     if (TechbaseProject?.length === 0) 
    //     {
    //         contentDiv.innerHTML = "No Data Found";
    //     } 
    //     else 
    //     {
    //         contentDiv.innerHTML = TechbaseProject.map(appendCard).join('');

    //         // Update navigation and headings
    //         headings = document.querySelectorAll('section h4');
    //         generateNavigation();

    //         // Apply `current` to the first title after filtering
    //         applyCurrentClassToFirstHeading();
    //     }
    // };

    window.findDropdownValue = function(selectedTechnologies) {
        console.log('Selected technologies:', selectedTechnologies);

        const selectedArray = Array.isArray(selectedTechnologies) ?
            selectedTechnologies :
            Object.values(selectedTechnologies);

        // Clear previous content
        contentDiv.innerHTML = '';
        scrollSpy.innerHTML = ''; // Clear the navigation as well

        const TechbaseProject = projectListing?.filter((project) => {
            const projectTechnologies = project.technologies.map((tech) => tech.toLowerCase());

            // Check if all selected technologies exist in the project's technologies
            return selectedArray.every((selectedTech) =>
                projectTechnologies.includes(selectedTech.toLowerCase())
            );
        });

        if (TechbaseProject?.length === 0) 
        {
            contentDiv.innerHTML = "No Data Found";
        } 
        else 
        {
            contentDiv.innerHTML = TechbaseProject.map(appendCard).join('');

            // Update navigation and headings
            headings = document.querySelectorAll('section h4');
            generateNavigation();

            // Apply `current` to the first title after filtering
            applyCurrentClassToFirstHeading();
        }
    };


    function calculateCurrentHeader() 
    {
        if (!headings.length) return;

        let newCurrentHeading = headings[0];
        for (let i = 0; i < headings.length; i++) 
        {
            if (headings[i].offsetTop - 25 < window.scrollY) 
            {
                newCurrentHeading = headings[i];
            }
        }

        if (currentHeading !== newCurrentHeading) 
        {
            if (currentHeading) 
            {
                removeCurrentClass(currentHeading);
            }

            currentHeading = newCurrentHeading;
            addCurrentClass(currentHeading);
        }
    }

    function applyCurrentClassToFirstHeading() 
    {
        if (headings.length > 0) 
        {
            const firstHeading = headings[0];
            clearCurrentClass();
            currentHeading = firstHeading;
            addCurrentClass(firstHeading);
        }
    }

    function addCurrentClass(heading) 
    {
        const link = getNavigationLinkByHeading(heading);
        if (link) link.classList.add(CURRENT_HEADING_CLASS);
    }

    function removeCurrentClass(heading) 
    {
        const link = getNavigationLinkByHeading(heading);
        if (link) link.classList.remove(CURRENT_HEADING_CLASS);
    }

    function clearCurrentClass() 
    {
        document.querySelectorAll(`.${CURRENT_HEADING_CLASS}`).forEach((el) => {
            el.classList.remove(CURRENT_HEADING_CLASS);
        });
    }

    function generateNavigation() 
    {
        const ul = document.createElement('ul');
        scrollSpy.innerHTML = ''; // Clear previous navigation

        headings.forEach((h) => {
            const anchor = createHeaderAnchor(h.innerText);
            const el = document.createElement('a');
            el.href = `#${anchor}`;
            el.innerText = h.innerText;

            const li = document.createElement('li');
            li.appendChild(el);
            ul.appendChild(li);
        });

        scrollSpy.appendChild(ul);
    }

    function getNavigationLinkByHeading(heading) 
    {
        const href = `#${createHeaderAnchor(heading.innerText)}`;
        return document.querySelector(`a[href="${href}"]`);
    }

    function createHeaderAnchor(title) 
    {
        return title.toLowerCase().replace(/ /g, '-').replace(/[^a-z0-9-]/g, '');
    }
});